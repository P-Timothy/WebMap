<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <title>Filter symbols by toggling a list</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js"></script>
    <link rel="stylesheet" href="yearMapC.css">
    <link href="nouislider.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@400;500&family=Roboto+Mono&family=Yanone+Kaffeesatz:wght@400;500&display=swap" rel="stylesheet">
    <script src="nouislider.js"></script>
        <!-- https://p-timothy.github.io/WebMap/Econ/yearMap.html -->
    <style>
        body { 
            margin: 0; padding: 0; 
        }
        #map { 
            position: absolute; top: 0; bottom: 0; width: 100%; 
        }
    </style>
    </head>
    
    <body>

        
        <div id="map"></div>
        
        <div id='topbar'>
            <div id="titlebar">
                <h2 id="title">  Japanese Manufacturing Plants 1912-1992  </h2>
                <sup id='info' onclick="infoBtn()">&#128712;</sup>
                
            </div>

            <div id='userControl'>
                <div id="timePlayer">

                    <label class="switch" id='Play'>
                      <input type="checkbox" onclick="go()">
                      <span class="slider" id='playbutton'>Play</span>
                    </label>

                    <label class="switch" id="BtmLck" onclick="lockbottom()">
                        <span class="yearClass" id="minYear">1960</span>
                        <span class="tooltiptext">Click to lock<br><span id='lockedBtm'>Locked</span></span>
                    </label>
                    
                    <div class="slider-styled" id="slider"></div>

                    <label class="switch" id="TopLock" onclick="locktop()">
                        <span class="yearClassR" id="maxYear">1992</span>
                        <span class="tooltiptext">Click to lock<br><span id='lockedTop'>Unlocked</span></span>
                    </label>
                    
                    
                    
                    
                </div>
            </div>
            
            <div id="TABBY">
                <span id='TabsBB'>&#x5e;</span>
            </div>
        </div>
        
        
        
        <div id='Filters'>
            <div id="filterDiv">
                <span id="FilterX">&#128712;</span>
                <span id="FilterTitle">Filter:</span>
                <span class="closeLeg" onclick="FilBtn()" id='FilX'>&times;</span>
            </div>
            
            <div id="FilterHiddenSection">
                
                
                <div id='jvFilter'>
                    
                    <div class="jvtri-state-toggle">
                      <input class="jvButton" type="radio" name="toggle" id="jvone" onclick="settingTheFilter('nojv')"/>
                      <input class="jvButton" type="radio" name="toggle" id="jvtwo" onclick="settingTheFilter('jv')"/>
                      <input class="jvButton" type="radio" name="toggle" id="jvthree" onclick="settingTheFilter('alljv')"/>
                    </div>
                    <label for='jv'>Joint Venture</label><br>

                    
                    <div class="aqtri-state-toggle">
                      <input class="aqButton" type="radio" name="toggle" id="aqone" onclick="settingTheFilter('noaq')"/>
                      <input class="aqButton" type="radio" name="toggle" id="aqtwo" onclick="settingTheFilter('aq')"/>
                      <input class="aqButton" type="radio" name="toggle" id="aqthree" onclick="settingTheFilter('allaq')"/>
                    </div>
                    <label for='aq'>Acquisition</label><br>

                    
                    <div class="nwtri-state-toggle">
                      <input class="nwButton" type="radio" name="toggle" id="nwone" onclick="settingTheFilter('nonw')"/>
                      <input class="nwButton" type="radio" name="toggle" id="nwtwo" onclick="settingTheFilter('nw')"/>
                      <input class="nwButton" type="radio" name="toggle" id="nwthree" onclick="settingTheFilter('allnw')"/>
                    </div>
                    <label for='new'>New</label><br>
                </div>
                
                <div id='rtwsFilter'>
                    <label form="sicVal">Additional Layers:<br></label>
                    <label>
                        <input class='rtwCheckbox' id='checkers' type="checkbox" onclick="rtwsBtn()">
                        <span class="" id='rtwText'>Right To Work States</span>
                    </label>
                    <label>
                        <br>
                        <input class='rtwCheckbox' id='checkers' type="checkbox" onclick="symbolBtn()">
                        <span class="" id='rtwText'>Symbol Layer (No Filters)</span>
                    </label>
                </div>
                
                <div id="SIC1filter">
                    <label form="sicVal">SIC Code:<br></label>
                    <input type="text" id="sicVal" name="sicVal" list="options" onclick='sicValClick()'>
                    <datalist id="options">
                        <option value="Food" ></option>
                        <option value="Raw Materials" ></option>
                        <option value="Metal" ></option>
                        <option value="Machinery" ></option>
                        <option value="Electronics" ></option>
                        <option value="Automotives" ></option>
                        <option value="Misc" ></option>
                    </datalist>
                    <button onclick="sicGo()" id="goButton">Go</button>
                </div>
                
            </div>
            
        </div>

        
        
        
        <!-- Title Info Modal -->
        <div id="infoModal" class="modal">
          <!-- Modal content -->
            <div class="info-modal-content">
                <span class="close">&times;</span>

                <h2> Project Overview. </h2>
                
                <p>
                    Goal - The goal of this project was to visualize a dataset used for research that has not been visualized yet. The study looked into the aggregation of foreign manufacturing plants in the United States. Specifically looking into Japanese investment and acquisition of manufacturing plants in the United States of America.
                    <br><br>
                    
                    <br>
                    Datasets: 
                    <br>
                    Manufacturing Plants - The point dataset used for this web map was provided by Bruce Blonigen. It is comprised of single points representing a Manufacturing plant acquired or constructed by Japanese Investors. This dataset contains additional variables, those being; SIC number, types of products, year established, locational information, as well as additional information about the parent companies. The GeoJson used for this project can be found <a id="link" href="https://github.com/p-timothy/WebMap/blob/main/Econ/EconUpdated.geojson" target="_blank" rel="noopener noreferrer"> here</a>.
                    <br><br>
                    Right To Work - The state polygons used come from the 2018 census and were the 20m shapefiles. Data about states' right to work was then added to the state polygon layer, this data was found at <a id="link" href="https://nrtwc.org/facts/state-right-to-work-timeline-2016/" target="_blank" rel="noopener noreferrer"> The National Right To Work Committee</a>. Visualizing all states with right-to-work dates before 1980.
                    <br><br>
                    Base Map -  The base map currently being used is a slightly customized version of the monochrome MapBox layer. (mapbox://styles/ptimmys/cli0j2lad00ul01po2d4t5fyo) 
                    <br><br>
                    Sources 
                    <br>
                    [<a href="https://github.com/p-timothy/WebMap/blob/main/Econ/EconUpdated.geojson" id="link" target="_blank" rel="noopener noreferrer">
                    Manufacturing Plants
                    </a>]
                    
                    [<a href="https://nrtwc.org/facts/state-right-to-work-timeline-2016/" id="link" target="_blank" rel="noopener noreferrer">
                    Right To Work States
                    </a>]
                    
                    [<span id="link" class="MapBoxCopy" onclick="MapboxStyle()">
                    Mapbox Style
                    </span>]
                    <br>
                    [<a href="https://refreshless.com/nouislider/" id="link" target="_blank" rel="noopener noreferrer">
                    NoUiSlider
                    </a>]
                    
                    [<a href="https://webcodespace.com/how-to-create-a-three-state-toggle-switch-using-html-css-and-javascript/" id="link" target="_blank" rel="noopener noreferrer">
                    CSS Three Position Toggles
                    </a>]
                </p>
            </div>
        </div>
        
        <div id="coppiedText">
            <p id="pincopy">Link was coppied to your clipboard!</p>
        </div>
        
        <!-- Filter Info Modal -->
        <div id="filterInfoModal" class="modal">
          <!-- Modal content -->
            <div class="info-modal-content">

                <h2> Additional Filter Info. </h2>
                
                <p>
                    Filters: 
                    <br><br>
                    Switches - Filter by Joint Venture, Acquisitions, or New manufacturing plants by switching a flip! The middle position means there is no filter currently being applied, the right position (green) means the filter for that layer is active, and the left position (red) means that the layer is filtered out. <br>
                    Example: If the Joint Venture filter is green, all Joint Venture manufacturing plants will be shown (this includes some Acquisition plants). In order to just view the Joint Venture layer, the Joint Venture switch should be green and the Acquisition and New switches should be red. *Note that the datasets have some plants which are both Joint Ventures and Acquisitions, but no New plant is a Joint Venture or Acquisition.
                    <br><br>
                    SIC filter - Filter by individual Standard Industrial Classification (ex: '3711'), SIC ranges (ex: '3100 3560'), or select a predefined range (ex: 'Machinery').
                    <br>
                    [<a href="https://www.osha.gov/data/sic-search?field_sic_number_value=3711&title_and_body=" id='link' target="_blank" rel="noopener noreferrer">SIC value search</a>] 
                    [<a href="https://www.sec.gov/corpfin/division-of-corporation-finance-standard-industrial-classification-sic-code-list" id='link' target="_blank" rel="noopener noreferrer">SIC value list</a>]
                    
                    <br><br>
                    Right to Work States - This layer was derived from the <a href="https://nrtwc.org/facts/state-right-to-work-timeline-2016/" id='link' target="_blank" rel="noopener noreferrer"> National Right to Work Committee </a> and was then joined to the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html" id="link" target="_blank" rel="noopener noreferrer">2018 sensus Cartographic Boundary Files</a> 
                    <br>
                    This layer shows all states with Right to Work laws pre 1980.
                    <br><br>
                </p>
            </div>
        </div>
        
        
        
        
        <div class="LegendContainer">
            <div id="Ltitle">
                <span id='LegTitle'>Legend: &nbsp;</span>
                <span class="closeLeg" onclick="LegBtn()" id='legX'>&times;</span>
            </div>
            <div id="LegendItems">
                <div class="legendItem">
                    <span class="food" id='food'>&#11044;</span>
                    <span class="layerDescription">Food &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sic: 2032-2099)</span>
                </div>
                <br>
                <div class="legendItem">
                    <span class="rawMaterials" id="rawMaterials">&#11044;</span>
                    <span class="layerDescription">Textiles/Raw Materials  (sic: 2259-3297)</span>
                </div>
                <br>
                <div class="legendItem">
                    <span class="metals" id="metals">&#11044;</span>
                    <span class="layerDescription">Metal Products &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sic: 3312-3498)</span>
                </div>
                <br>
                <div class="legendItem">
                    <span class="machinery" id="machinery">&#11044;</span>
                    <span class="layerDescription">Machinery &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sic: 3531-3593)</span>
                </div>
                <br>
                <div class="legendItem">
                    <span class="electronics" id="electronics">&#11044;</span>
                    <span class="layerDescription">Electronics &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sic: 3616-3695)</span>
                </div>
                <br>
                <div class="legendItem">
                    <span class="auto" id="auto">&#11044;</span>
                    <span class="layerDescription">Automotives &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sic: 3711-3716)</span>
                </div>
                <br>
                <div class="legendItem">
                    <span class="miscManf" id="miskManf">&#11044;</span>
                    <span class="layerDescription">Misc. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (sic: 3700-3999)</span>
                </div>
                <div id="RightToWorkLegend">
                    <br>
                    <span class="legHi" id="legendHighlights"></span>
                    <span class="rtwSquareClassA" id="rtwSquare">&#x25A1;</span>
                    <span class="rtwSquareClassB" id="rtwSquare">&#x25A0;</span>
                    <span class="layerDescription" id='rtwsleg'>Right To Work States - pre 1980</span>
                </div>
            </div>
        </div>
       
<!--   <a target="_blank" href="https://icons8.com/icon/4516/new-moon">New Moon</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/4048/factory">Factory</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/3954/barbell">Barbell</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/4054/gear">Gear</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/86540/electric">Electric</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/3788/layers">Layers</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/3271/car">Auto</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>

<a target="_blank" href="https://icons8.com/icon/7622/ingredients">Ingredients</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a>   -->
        
        <script>
            
            
//Mapbox setup//
            
            mapboxgl.accessToken = 'pk.eyJ1IjoicHRpbW15cyIsImEiOiJjbGc1ZnAxenYwMnZ6M3NvOG0zcGpzZmx4In0.drh78VNuPvJOOpSrS8wsGQ';
            
            const bounds = [
                [-180,-5], //SW corner
                [-30,76]   //NE corner
            ]
            
            //  load map  //
            var map = new mapboxgl.Map({
                container: 'map', // container id
                style: 'mapbox://styles/ptimmys/cli0j2lad00ul01po2d4t5fyo',  // stylesheet location
                projection: 'globe',
                center: [-95.7129, 37.0902],
                zoom: 3,
                minZoom: 1, 
                maxZoom: 11,
                maxBounds: bounds,
            });
            
            // load data when map is loaded
            map.on('load', () => {
               
                // Load In Custom Images
                map.loadImage('./Symbols/auto-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('auto', image);
                });
                
                map.loadImage('./Symbols/metl-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('metl', image);
                });
                
                map.loadImage('./Symbols/elec-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('elec', image);
                });
                
                map.loadImage('./Symbols/mach-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('mach', image);
                });
                
                map.loadImage('./Symbols/food-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('food', image);
                });
                
                map.loadImage('./Symbols/text-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('text', image);
                });
                
                map.loadImage('./Symbols/misc-img.png',
                             (error, image) => {
                    if (error) throw error;
                    
                    map.addImage('misc', image);
                });
                
                
                
                //Add In Data Sources
                // add manfplants geojson source
                map.addSource('ManfPlants', {
                    'type': 'geojson',
                    data: './EconUpdated.geojson',
                });
                
                map.addSource('ManfPlantSym', {
                    'type': 'geojson',
                    data: './Econ.geojson',
                });
                
                // add rtws geojson source
                map.addSource('rightToWorkStates', {
                    'type': 'geojson',
                    data: './rtwStates.geojson',
                });
                
                map.addSource('rtws', {
                    'type': 'geojson',
                    data: './rtwStates.geojson',
                });
                
                
                // Add in image layers
                map.addLayer({
                        'id': 'RTWS',
                        'type': 'fill',
                        'source': 'rightToWorkStates',
                        paint: {
                            'fill-color': "rgba(137, 176, 137, 0.3)",
                        }
                    });
                map.setFilter('RTWS', ['==', 'id', 0]);
                
                map.addLayer({
                    'id': 'RTWSline',
                    'type': 'line',
                    'source': 'rightToWorkStates',
                    paint: {
                        'line-color': "rgba(175, 196, 175, 0.6)",
                        'line-width': 1,
                    }
                });
                

                // add geojson as a layer
                map.addLayer({
                    'id': 'plantYears',
                    'type': 'circle',
                    'source': 'ManfPlants',
                    paint: {
                        'circle-color': dataStyle[0],
                    }
                });  
                
                map.addLayer({
                    'id': 'plant',
                    'type': 'symbol',
                    'source': 'ManfPlantSym',
                    'layout': {
                        'icon-image': ['get', 'icon'],
                        'icon-allow-overlap': true,
                        'icon-size': .7,
                    },
                    'filter': ['==', 'IDNUM', 0]
                });  
                
// Popups!
    // Symbol Layer
                map.on('click', 'plant', (e) => {
                    const coordinates = e.features[0].geometry.coordinates.slice();
                    const description = e.features[0].properties.description;
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }
                    new mapboxgl.Popup()
                        .setLngLat(coordinates)
                        .setHTML(
                        '<strong>Name:</strong> ' + e.features[0].properties.CNAME + '<br>' +
                        '<strong>Products:</strong> ' + e.features[0].properties.CPRODS + '<br>' +
                        '<strong>SIC:</strong> ' + e.features[0].properties.SIC1 + '<br>' +
                        '<strong>Location:</strong> ' + e.features[0].properties.formatted_ + '<br>' +
                        '<strong>Location Accuracy:</strong> ' + e.features[0].properties.location_t + '<br>' +
                        '<strong>Parent Company 1:</strong> ' + e.features[0].properties.P1NAME + '<br>' +
                        '<strong>Share Percentage:</strong> ' + e.features[0].properties.P1SHARE + '<br>' +
                        '<strong>Home:</strong> ' + e.features[0].properties.P1HOME + '<br>' +
                        '<strong>Parent Company 2:</strong> ' + e.features[0].properties.P2NAME + '<br>' +
                        '<strong>Share Percentage:</strong> ' + e.features[0].properties.P2SHARE + '<br>' +
                        '<strong>Home:</strong> ' + e.features[0].properties.P2HOME
                    )
                        .addTo(map);
                });
                map.on('mouseenter', 'plant', () => {
                    map.getCanvas().style.cursor = 'pointer';
                });
                map.on('mouseleave', 'plant', () => {
                    map.getCanvas().style.cursor = '';
                });
                
    // Point Layer
                map.on('click', 'plantYears', (e) => {
                    const coordinates = e.features[0].geometry.coordinates.slice();
                    const description = e.features[0].properties.description;
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }
                    new mapboxgl.Popup()
                        .setLngLat(coordinates)
                        .setHTML(
                        '<strong>Name:</strong> ' + e.features[0].properties.CNAME + '<br>' +
                        '<strong>Products:</strong> ' + e.features[0].properties.CPRODS + '<br>' +
                        '<strong>SIC:</strong> ' + e.features[0].properties.SIC1 + '<br>' +
                        '<strong>Location:</strong> ' + e.features[0].properties.formatted_ + '<br>' +
                        '<strong>Location Accuracy:</strong> ' + e.features[0].properties.location_t + '<br>' +
                        '<strong>Parent Company 1:</strong> ' + e.features[0].properties.P1NAME + '<br>' +
                        '<strong>Share Percentage:</strong> ' + e.features[0].properties.P1SHARE + '<br>' +
                        '<strong>Home:</strong> ' + e.features[0].properties.P1HOME + '<br>' +
                        '<strong>Parent Company 2:</strong> ' + e.features[0].properties.P2NAME + '<br>' +
                        '<strong>Share Percentage:</strong> ' + e.features[0].properties.P2SHARE + '<br>' +
                        '<strong>Home:</strong> ' + e.features[0].properties.P2HOME
                    )
                        .addTo(map);
                });
                map.on('mouseenter', 'plantYears', () => {
                    map.getCanvas().style.cursor = 'pointer';
                });
                map.on('mouseleave', 'plantYears', () => {
                    map.getCanvas().style.cursor = '';
                });
                
                
                
            });
            
            // disable map rotation using right click + drag
            map.dragRotate.disable();

            // disable map rotation using touch rotation gesture
            map.touchZoomRotate.disableRotation();
            
            // Add zoom and rotation controls to the map.
            // *Note: Not in use as stylizing the map controls is, to me, impossible :(
            // map.addControl(new mapboxgl.NavigationControl());
            
            
            
//Variabels//
            
            // style variabel
            const dataStyle = [[
                                  "match",
                                  ["get", "SIC1"],
                                  0,
                                  [
                                    "interpolate",
                                    ["linear"],
                                    ["get", "SIC1"],
                                    2011,"#157CAE",2099,"#157CAE",

                                    2100,"#D7AA27",3299,"#D7AA27",

                                    3300,"#AF272F",3499,"#AF272F",

                                    3500,"#00AEEF",3599,"#00AEEF",

                                    3600,"#FFF200",3699,"#FFF200",

                                    3700,"#4D5859",3710,"#4D5859",

                                    3711,"#EC008C",3716,"#EC008C",

                                    3717,"#4D5859",3999,"#4D5859"

                                  ],
                                  [
                                    "interpolate",
                                    ["linear"],
                                    ["get", "SIC1"],
                                    2011,"#157CAE",2099,"#157CAE",

                                    2100,"#D7AA27",3299,"#D7AA27",

                                    3300,"#AF272F",3499,"#AF272F",

                                    3500,"#00AEEF",3599,"#00AEEF",

                                    3600,"#FFF200",3699,"#FFF200",

                                    3700,"#4D5859",3710,"#4D5859",

                                    3711,"#EC008C",3716,"#EC008C",

                                    3717,"#4D5859",3999,"#4D5859"
                                   ]
                                ]];
            

            
            const yearLi = [
                1960, 1961, 1962, 1963, 1964, 1965, 1966, 
                1967, 1968, 1969, 1970, 1971, 1972, 1973,
                1974, 1975, 1976, 1977, 1978, 1979, 1980, 
                1981, 1982, 1983, 1984, 1985, 1986, 1987,
                1988, 1989, 1990, 1991, 1992
            ];
            
            // filter variables
            var JovFilter = ['>=','IDNUM', 0];
            var AcqFilter = ['>=','IDNUM', 0];
            var NewFilter = ['>=','IDNUM', 0];
            var minYearFilter = ['<=', 'YEAR', 0];
            var maxYearFilter = ['>=', 'YEAR', 4000];
            var sicFilter = ['>=', 'SIC1', 0];
            var sicFilterMax = ['>=', 'SIC1', 0];
            
            // toggle state variables
            var legendToggle = 1;
            var playToggle = 1;
            var filterTog = 1;
            var rtwsOn = 0;
            var playCon = 0;
            var AqF = 0;
            var NwF = 0;
            var JvF = 0;
            var symOn = 0;
            
            var minvalue = 0;
            var maxvalue = 32;
            var LockBottom = true;
            var LockTop = false;
            
            // Elemt variables
            let ziggy = document.getElementById('minYear');
            let iggy = document.getElementById('maxYear');
            var slider = document.getElementById('slider');
            var select = document.getElementById('spanID');
            var modal = document.getElementById("infoModal");
            var Leg = document.getElementById("LegendItems");
            var LegX = document.getElementById('legX');
            var TABBIE = document.getElementById("TABBY");
            var usrCon = document.getElementById('userControl');
            var filCB = document.getElementById('FiltersCheckBox');
            var filbox = document.getElementById('FilterHiddenSection');
            var filX = document.getElementById('FilterX');
            var filHelp = document.getElementById('filterInfoModal');
            var cT = document.getElementById('coppiedText');
            var ccmsg = 0;
            // Get the button that opens the modal
            var btn = document.getElementById("myBtn");
            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];
            
            
            
            
            
            
            
            
            
            
// Modal
            
            // open modal on click
            function infoBtn () {
                modal.style.display = "block";
            }
            
            filX.onclick = function() {
                filHelp.style.display = "block";
            }
            
            
            // close modal on click
            span.onclick = function () {
                modal.style.display = 'none';
                filHelp.style.display = 'none';
            }
            
            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
              if (event.target == modal) {
                modal.style.display = "none";
              } else if (event.target == filHelp) {
                filHelp.style.display = "none";
              }
            }
            
            // copy mapbox style to clipboard when clicked in Info Pannel
            function MapboxStyle() {
                let coppyTxt = 'mapbox://styles/ptimmys/cli0j2lad00ul01po2d4t5fyo';
                navigator.clipboard.writeText(coppyTxt);
                coppyToClipboardMessage();
                setTimeout(coppyToClipboardMessage, 3000);
            };
            
            
            

            
// Hide Time Player Drop Down
            // Time player closing tab, rotate 180 deg, and change border radius when clicked
            TABBIE.onclick = function() {
                if (playToggle == 0) {
                    usrCon.style.display = 'block';
                    TABBIE.style.top = '105px';
                    TABBIE.style.transform = "rotate(0deg)";
                    TABBIE.style.borderRadius = "0px 0px 5px 5px";
                    playToggle = 1;
                } else {
                    usrCon.style.display = 'none';
                    TABBIE.style.top = '50px';
                    TABBIE.style.transform = "rotate(180deg)";
                    TABBIE.style.borderRadius = "5px 5px 0px 0px";
                    playToggle = 0;
                }
            }
            
            
// Bottom Two Pannels
            // Toggle Legend Pannel
            function LegBtn () {
                if (legendToggle == 1) {
                    Leg.style.display = 'none';
                    LegX.innerHTML = '&plus;';
                    legendToggle = 0;
                } else {
                    Leg.style.display = 'block';
                    LegX.innerHTML = '&times;';
                    legendToggle = 1;
                }
            }
            
            // Toggle Filter Button
            function FilBtn () {
                if (filterTog == 1) {
                    filbox.style.display = 'none';
                    document.getElementById('FilX').innerHTML = '&plus;';
                    filterTog = 0;
                } else {
                    filbox.style.display = 'block';
                    document.getElementById('FilX').innerHTML = '&times;';
                    filterTog = 1;
                }
            }
            
            // Right to work states add data 
            function rtwsBtn() {
                if (rtwsOn == 0) {
                    map.setFilter('RTWS', ['==', 'rtwID', 1]);
                    document.getElementById('RightToWorkLegend').style.display = 'block';
                    rtwsOn = 1;
                    
                } else if (rtwsOn == 1) {
                    map.setFilter('RTWS', ['==', 'id', 0]);
                    document.getElementById('RightToWorkLegend').style.display = 'none';
                    rtwsOn = 0;
                }
            };
            
            // Symbol layer
            function symbolBtn() {
                if (symOn == 0) {
                    map.setFilter('plant', ['>=', 'IDNUM', 1]);
                    map.setFilter('plantYears', ['==', 'IDNUM', 0]);
                    symOn = 1;
                    
                } else if (symOn == 1) {
                    map.setFilter('plantYears', ['>=', 'IDNUM', 1]);
                    map.setFilter('plant', ['==', 'IDNUM', 0]);
                    symOn = 0;
                }
            };
            
            
            // dispaly a copy to clipboard message
            function coppyToClipboardMessage() {
                if (ccmsg == 0) {
                    cT.style.display = "block";
                    ccmsg = 1;
                } else {
                    cT.style.display = "none";
                    ccmsg = 0;
                }
            };
            
            // js from https://webcodespace.com/how-to-create-a-three-state-toggle-switch-using-html-css-and-javascript/ //
            var jvbuttons = document.getElementsByClassName("jvButton");
            var jvarr = [...jvbuttons];

            jvarr.forEach((element, index) => {
                element.addEventListener("click", () => {
                    element.style.opacity = "1";
                    jvarr
                        .filter(function (item) {
                        return item != element;
                    })
                        .forEach((item) => {
                        item.style.opacity = "0";
                    });
                });
            });

            var aqbuttons = document.getElementsByClassName("aqButton");
            var aqarr = [...aqbuttons];

            aqarr.forEach((element, index) => {
                element.addEventListener("click", () => {
                    element.style.opacity = "1";
                    aqarr
                        .filter(function (item) {
                        return item != element;
                    })
                        .forEach((item) => {
                        item.style.opacity = "0";
                    });
                });
            }); 

            var nwbuttons = document.getElementsByClassName("nwButton");
            var nwarr = [...nwbuttons];

            nwarr.forEach((element, index) => {
                element.addEventListener("click", () => {
                    element.style.opacity = "1";
                    nwarr
                        .filter(function (item) {
                        return item != element;
                    })
                        .forEach((item) => {
                        item.style.opacity = "0";
                    });
                });
            }); 

///////////////////////////////////////////////////////////////////////////
            
            
            
            
            
            
            
            
            /////////////////////////////////////////////////////////
            //                    No UI Slider                     //
            /////////////////////////////////////////////////////////
            
            
            
            
            var slideEvList = noUiSlider.create(slider, {
                start: [0, 32],
                connect: true,
                range: {
                    'min': 0,
                    'max': 32
                },
                step: 1,
                behaviour: 'tap-drag',
            });
                
            
            
            // play button function
            function go() {
                if (playCon == 0) {
                    document.getElementById('playbutton').innerHTML = "Pause";
                    runTimer();
                    playCon = 1;
                    document.getElementById('playbutton').checked = true;
                } else {
                    document.getElementById('playbutton').innerHTML = "Play";
                    clearInterval(timer);
                    playCon = 0;
                    document.getElementById('playbutton').checked = false;
                }
            };
            
            // call the timer Function 
            function runTimer(){
                timer = setInterval(myTimer, 1000);
            };
            // timer funciton, updates slider values
            function myTimer() {
                var years = slider.noUiSlider.get();
                if (LockBottom == true) {
                    var minyears = Number(years[0]);
                } else {
                    var minyears = Number(years[0]) + 1;
                }
                if (LockTop == true) {
                    var maxyears = Number(years[1]);
                } else {
                    var maxyears = Number(years[1]) + 1;
                }
                
                if (maxyears > 32){
                    slider.noUiSlider.set([null, minyears]);
                } else {
                    slider.noUiSlider.set([minyears, maxyears]);
                }
            };
            
                        
            function yearTextContent(heldValues) {
                document.getElementById('maxYear').textContent = Number(heldValues[1]);
                document.getElementById('minYear').textContent = Number(heldValues[0]);
            };
            
            
            
            
            function lockbottom() {
                if (LockBottom==true) {
                    ziggy.style.color = '#fff9d1';
                    document.getElementById('lockedBtm').innerHTML = 'Unlocked';
                    LockBottom = false;
                    
                } else {
                    ziggy.style.color = '#ffe008';
                    document.getElementById('lockedBtm').innerHTML = 'Locked';
                    LockBottom = true;
                }
            };
            
            
            function locktop() {
                if (LockTop==true) {
                    iggy.style.color = '#fff9d1';
                    document.getElementById('lockedTop').innerHTML = 'Unlocked';
                    LockTop = false;
                } else {
                    iggy.style.color = '#ffe008';
                    document.getElementById('lockedTop').innerHTML = 'Locked';
                    LockTop = true;
                }
            };
            
            
            function settingTheFilter(something) {
                if (something == 'nojv') {
                    JovFilter = ['!=', 'JV', true];
                    
                } else if (something == 'jv') {
                    JovFilter = ['>=','IDNUM', 0];
                    
                } else if (something == 'alljv') {
                    JovFilter = ['==', 'JV', true];
                    
                } else if (something == 'noaq') {
                    AcqFilter = ['!=', 'ACQUIRE', true];
              
                } else if (something == 'aq') {
                    AcqFilter = ['>=','IDNUM', 0];
                
                } else if (something == 'allaq') {
                    AcqFilter = ['==', 'ACQUIRE', true];
                
                } else if (something == 'nonw') {
                    NewFilter = ['!=', 'NEW', true];
                
                } else if (something == 'nw') {
                    NewFilter = ['>=','IDNUM', 0];
                
                } else if (something == 'allnw') {
                    NewFilter = ['==', 'NEW', true];
                }
                
                setFilterFunction();
            };
            
            
            
            
            
            
            const food = document.getElementById('food');
            const rawMaterials = document.getElementById('rawMaterials');
            const metal = document.getElementById('metal');
            const machinery = document.getElementById('machinery');
            const electronics = document.getElementById('electronics');
            const auto = document.getElementById('auto');
            const miscManf = document.getElementById('miscManf');
            
            
            
            
            
            function sicGo() {
                var inputVal = document.getElementById('sicVal').value;
                if (inputVal == '') {
                    sicFilter = ['>=', 'SIC1', 0];
                    sicFilterMax = ['>=', 'SIC1', 0];
                    document.getElementById('food').classList.remove('HiddenLegend');
                    document.getElementById('rawMaterials').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.remove('HiddenLegend');
                    document.getElementById('machinery').classList.remove('HiddenLegend');
                    document.getElementById('electronics').classList.remove('HiddenLegend');
                    document.getElementById('auto').classList.remove('HiddenLegend');
                    document.getElementById('miskManf').classList.remove('HiddenLegend');
                    
                    
                    
                    
                } else if (inputVal == 'Food') {
                    sicFilter = ['>=', 'SIC1', 2000];
                    sicFilterMax = ['<=', 'SIC1', 2100];
                    document.getElementById('food').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.add('HiddenLegend');
                    document.getElementById('rawMaterials').classList.add('HiddenLegend');
                    document.getElementById('machinery').classList.add('HiddenLegend');
                    document.getElementById('electronics').classList.add('HiddenLegend');
                    document.getElementById('auto').classList.add('HiddenLegend');
                    document.getElementById('miskManf').classList.add('HiddenLegend');
                
                
                } else if (inputVal == 'Misc') {
                    sicFilter = ['>=', 'SIC1', 3700];
                    sicFilterMax = ['<=', 'SIC1', 5000];
                    document.getElementById('miskManf').classList.remove('HiddenLegend');
                    document.getElementById('auto').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.add('HiddenLegend');
                    document.getElementById('rawMaterials').classList.add('HiddenLegend');
                    document.getElementById('machinery').classList.add('HiddenLegend');
                    document.getElementById('electronics').classList.add('HiddenLegend');
                    document.getElementById('food').classList.add('HiddenLegend');
                
                
                } else if (inputVal == 'Raw Materials') {
                    sicFilter = ['>=', 'SIC1', 2200];
                    sicFilterMax = ['<=', 'SIC1', 3299];
                    document.getElementById('rawMaterials').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.add('HiddenLegend');
                    document.getElementById('food').classList.add('HiddenLegend');
                    document.getElementById('machinery').classList.add('HiddenLegend');
                    document.getElementById('electronics').classList.add('HiddenLegend');
                    document.getElementById('auto').classList.add('HiddenLegend');
                    document.getElementById('miskManf').classList.add('HiddenLegend');
               
                
                } else if (inputVal == 'Metal') {
                    sicFilter = ['>=', 'SIC1', 3300];
                    sicFilterMax = ['<=', 'SIC1', 3499];
                    document.getElementById('metals').classList.remove('HiddenLegend');
                    document.getElementById('food').classList.add('HiddenLegend');
                    document.getElementById('rawMaterials').classList.add('HiddenLegend');
                    document.getElementById('machinery').classList.add('HiddenLegend');
                    document.getElementById('electronics').classList.add('HiddenLegend');
                    document.getElementById('auto').classList.add('HiddenLegend');
                    document.getElementById('miskManf').classList.add('HiddenLegend');
                
                
                } else if (inputVal == 'Machinery') {
                    sicFilter = ['>=', 'SIC1', 3500];
                    sicFilterMax = ['<=', 'SIC1', 3599];
                    document.getElementById('machinery').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.add('HiddenLegend');
                    document.getElementById('rawMaterials').classList.add('HiddenLegend');
                    document.getElementById('food').classList.add('HiddenLegend');
                    document.getElementById('electronics').classList.add('HiddenLegend');
                    document.getElementById('auto').classList.add('HiddenLegend');
                    document.getElementById('miskManf').classList.add('HiddenLegend');
                
                
                } else if (inputVal == 'Electronics') {
                    sicFilter = ['>=', 'SIC1', 3600];
                    sicFilterMax = ['<=', 'SIC1', 3699];
                    document.getElementById('electronics').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.add('HiddenLegend');
                    document.getElementById('rawMaterials').classList.add('HiddenLegend');
                    document.getElementById('machinery').classList.add('HiddenLegend');
                    document.getElementById('food').classList.add('HiddenLegend');
                    document.getElementById('auto').classList.add('HiddenLegend');
                    document.getElementById('miskManf').classList.add('HiddenLegend');
                
                
                } else if (inputVal == 'Automotives') {
                    sicFilter = ['>=', 'SIC1', 3711];
                    sicFilterMax = ['<=', 'SIC1', 3716];
                    document.getElementById('auto').classList.remove('HiddenLegend');
                    document.getElementById('metals').classList.add('HiddenLegend');
                    document.getElementById('rawMaterials').classList.add('HiddenLegend');
                    document.getElementById('machinery').classList.add('HiddenLegend');
                    document.getElementById('electronics').classList.add('HiddenLegend');
                    document.getElementById('food').classList.add('HiddenLegend');
                    document.getElementById('miskManf').classList.add('HiddenLegend');
               
                
                } else if (inputVal.length == 4) {
                    sicFilter = ['==', 'SIC1', Number(inputVal)];
                    sicFilterMax = ['==', 'SIC1', Number(inputVal)];
               
                
                } else if (inputVal.length == 9) {
                    var splitter = inputVal.split(' ')
                    sicFilter = ['<=', 'SIC1', Number(splitter[1])];
                    sicFilterMax = ['>=', 'SIC1', Number(splitter[0])];
               
                
                } else {
                    document.getElementById('sicVal').innerHTML = "Error";
                }
                
                
                setFilterFunction();
            }
           
            function sicValClick() {
                document.getElementById('sicVal').value = '';
            }
            
            
            
            
            slideEvList.on('update', function(values){
                minvalue = Number(values[0]);
                minvalue = yearLi[minvalue];
                minYearFilter = ['>=', 'YEAR', minvalue]

                maxvalue = Number(values[1]);
                maxvalue = yearLi[maxvalue];
                maxYearFilter = ['<=', 'YEAR', maxvalue]
                    
                
                setFilterFunction();

                var filters = [minvalue, maxvalue];

                yearTextContent(filters);
                });
            
            slider.noUiSlider.on('update', function (values, handle) {
                var value = values[handle];
                
                select.textContent = Math.round(values[1]-values[0]);
                
                if (handle) {
                    inputNumber.value = value;
                } else {
                    select.value = Math.round(values[1]-values[0]);
                };
            });
            
            select.addEventListener('change', function () {
                slider.noUiSlider.set([this.value, null]);
            });
            
            function setFilterFunction () {
                if (symOn == 0) {
                    map.setFilter('plantYears', ['all', maxYearFilter, minYearFilter, NewFilter, AcqFilter, JovFilter, sicFilter, sicFilterMax]);
                } else if (symOn == 1) {
                    map.setFilter('plant', ['all', maxYearFilter, minYearFilter, NewFilter, AcqFilter, JovFilter, sicFilter, sicFilterMax]);
                };
            }; 
            
            
            /* Switch JS code from https://webcodespace.com/how-to-create-a-three-state-toggle-switch-using-html-css-and-javascript/ */
            
            
           
            
        </script>
    </body>
</html>
