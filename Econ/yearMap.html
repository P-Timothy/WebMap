<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <title>Filter symbols by toggling a list</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js"></script>
    <link rel="stylesheet" href="yearMapC.css">
    <link href="nouislider.css" rel="stylesheet">
    <script src="nouislider.js"></script>
        <!-- https://p-timothy.github.io/WebMap/Econ/yearMap.html -->
    <style>
        body { 
            margin: 0; padding: 0; 
        }
        #map { 
            position: absolute; top: 0; bottom: 0; width: 100%; 
        }
    </style>
    </head>
    
    <body>

        
        <div id="map"></div>
        
        <!-- <div id='userInterface'>
            <button onclick="myFunction()">Play/Pause</button>
            <input id="yrSlider" type="range" min="0" max="32" step="1" value="0">
            <span id='yearDisplay'>1960</span>
            <button id='speedSetting' onclick="changeSpeed()">Change Speed</button>
            <br>
            
            <button id="darkMode" onclick="darkMode()">Dark/Light</button>
            
            <input type="number" id='yrRangeInput' min='1' max='10' step='1' value='1'> 
            <input id="yrRangeSlider" type="range" min="1" max="15" step="1" value="1">
            <span id='visYearNumber'>5</span> 
            
        </div> -->
        
        <div id='userControl'>
            <div id="timePlayer">
                <button onclick="go()">Play</button>
                <span id="minYear">1960</span>
                <div class="slider-styled" id="slider"></div>
                <span id="maxYear">1992</span>
                <!-- <button onclick='speed()'>Speed</button>-->
                <br>
                <!-- <span>Span: <span id="spanID"></span> years</span> -->
            </div>
            

        </div>
        
        <!--     THIS IS THE CODE FOR THE JV FILTERS, NOT WORKING RN SO THEYRE HIDDEN
        <div id="jvFilter">
            <input type='checkbox' id='all' name='all' onclick='filterbytype(0)' checked>
            <label for="all">All</label><br>
            <input type='checkbox' id='jv' name='jointv' onclick='filterbytype(1)'>
            <label for="jointv">Joint Venture</label><br>
            <input type='checkbox' id='aq' name='acqu' onclick='filterbytype(2)'>
            <label for="acqu">acquisition</label><br>
            <input type='checkbox' id='new' name='newplt' onclick='filterbytype(3)'>
            <label for="newplt">New Plant</label><br>
        </div>
        -->
        
        <!-- This div is used to create a legend: Span class color is changed in css under 'renter' and 'owner'  -->
        <div class="LegendContainer">
            <div class="legendItem">
                <span class="food">&#11044;</span>
                <span class="layerDescription">Food (sic: 2032-2099)</span>
            </div>
            <br>
            <div class="legendItem">
                <span class="miscManf">&#11044;</span>
                <span class="layerDescription">Misc. (sic: 37+, without Auto.)</span>
            </div>
            <br>
            <div class="legendItem">
                <span class="rawMaterials">&#11044;</span>
                <span class="layerDescription">Textiles/Raw Materials (sic: 2259-3297)</span>
            </div>
            <br>
            <div class="legendItem">
                <span class="metals">&#11044;</span>
                <span class="layerDescription">Metal Products (sic: 3312-3498)</span>
            </div>
            <br>
            <div class="legendItem">
                <span class="machinery">&#11044;</span>
                <span class="layerDescription">Machinery (sic: 3531-3593)</span>
            </div>
            <br>
            <div class="legendItem">
                <span class="electronics">&#11044;</span>
                <span class="layerDescription">Electronics (sic: 3616-3695)</span>
            </div>
            <br>
            <div class="legendItem">
                <span class="auto">&#11044;</span>
                <span class="layerDescription">Automotives (sic: 3711,3714, 3751)</span>
            </div>
        </div>
        

        <div id="creds"> 
            <span class='creator'>Author: P. Timothy Young Schragel</span>
        </div>

        
        <script>
            
            //////////////////////////////////////////////////////////
            //                     Mapbox setup                     //
            //////////////////////////////////////////////////////////
            mapboxgl.accessToken = 'pk.eyJ1IjoicHRpbW15cyIsImEiOiJjbGc1ZnAxenYwMnZ6M3NvOG0zcGpzZmx4In0.drh78VNuPvJOOpSrS8wsGQ';
            
            //  load map  //
            var map = new mapboxgl.Map({
                container: 'map', // container id
                style: 'mapbox://styles/mapbox/light-v11',  // stylesheet location
                    center: [-95.7129, 37.0902], 
                    zoom: 3
            });
            //////////////////////////////////////////////////////////
            
            
            /////////////////////////////////////////////////////////
            ///    Code for styles:                               ///
            /////////////////////////////////////////////////////////
            
            var playCon = 0;
            
            const yearLi = [
                1960, 1961, 1962, 1963, 1964, 1965, 1966, 
                1967, 1968, 1969, 1970, 1971, 1972, 1973,
                1974, 1975, 1976, 1977, 1978, 1979, 1980, 
                1981, 1982, 1983, 1984, 1985, 1986, 1987,
                1988, 1989, 1990, 1991, 1992
            ];
            
            const dataStyle = [[
                              "match",
                              ["get", "SIC1"],
                              0,
                              [
                                "interpolate",
                                ["linear"],
                                ["get", "SIC1"],
                                2011,"#577590",
                                2099,"#577590",
                                2100,"#90be6d",
                                3299,"#90be6d",
                                3300,"#f9c74f",
                                3499,"#f9c74f",
                                3500,"#f8961e",
                                3599,"#f8961e",
                                3600,"#f3722c",
                                3700,"#43aa8b",
                                3999,"#000000"
                              ],
                              [
                                "interpolate",
                                ["linear"],
                                ["get", "SIC1"],
                                2011,"#577590",
                                2099,"#577590",
                                2100,"#90be6d",
                                3299,"#90be6d",
                                3300,"#f9c74f",
                                3499,"#f9c74f",
                                3500,"#f8961e",
                                3599,"#f8961e",
                                3600,"#f3722c",
                                3700,"#43aa8b",
                                3999,"#000000"
                              ]
                            ]
                    ];
            
            
            /////////////////////////////////////////////////////////
            
            
            
            /////////////////////////////////////////////////////////
            //             Using a geojson file for now            //
            /////////////////////////////////////////////////////////
            
            function addDataLayer() {
                
                // add geojson source
                map.addSource('ManfPlants', {
                    'type': 'geojson',
                    data: './EconUpdated.geojson',
                });
                
                // add geojson as a layer
                map.addLayer({
                    'id': 'plantYears',
                    'type': 'circle',
                    'source': 'ManfPlants',
                    paint: {
                        'circle-color': dataStyle[0],
                    }
                });
            };
            
            // load data when map is loaded
            map.on('load', function(){
                addDataLayer();
            });
            
            //////////////////////////////////////////////////////////
            
            
            
            //////////////////////////////////////////////////////////
            //            This chunk handles DarkMode               //
            //////////////////////////////////////////////////////////
            var DM = 0;
            const DML = ['mapbox://styles/mapbox/light-v11', 'mapbox://styles/mapbox/dark-v11'];
            
            function darkMode() {
                
                if (DM == 0) {
                    DM = 1;
                    map.setStyle(DML[DM]);
                } else {
                    DM = 0;
                    map.setStyle(DML[DM]);
                };
            };
            
            // load data when style is changed
            map.on('style.load', function () {
                addDataLayer();
            });
            
            /////////////////////////////////////////////////////////
            

                
            /////////////////////////////////////////////////////////
            //                    No UI Slider                     //
            /////////////////////////////////////////////////////////
            var slider = document.getElementById('slider');
            var select = document.getElementById('spanID');
            var minvalue = 0;
            var maxvalue = 32;
            
            var slideEvList = noUiSlider.create(slider, {
                start: [0, 32],
                connect: true,
                range: {
                    'min': 0,
                    'max': 32
                },
                step: 1,
                behaviour: 'tap-drag',
            });
                slideEvList.on('update', function(values){
                    minvalue = Number(values[0]);
                    minvalue = yearLi[minvalue];
                    maxvalue = Number(values[1]);
                    maxvalue = yearLi[maxvalue];
                    filters = [minvalue, maxvalue]; //, plantTypeFilter()
                    
                    map.setFilter('plantYears', ['all', ['<=', 'YEAR', maxvalue], ['>=', 'YEAR', minvalue]]);
                    
                    yearTextContent(filters);
                });
            
            slider.noUiSlider.on('update', function (values, handle) {
                var value = values[handle];
                
                select.textContent = Math.round(values[1]-values[0]);
                
                if (handle) {
                    inputNumber.value = value;
                } else {
                    select.value = Math.round(values[1]-values[0]);
                };
            });
            
            select.addEventListener('change', function () {
                slider.noUiSlider.set([this.value, null]);
            });
            
            
            // play button function
            function go() {
                if (playCon == 0) {
                    runTimer();
                    playCon = 1;
                } else {
                    clearInterval(timer);
                    playCon = 0;
                }
            };
            
            // call the timer Function 
            function runTimer(){
                timer = setInterval(myTimer, 1000);
            };
            // timer funciton, updates slider values
            function myTimer() {
                var years = slider.noUiSlider.get();
                var minyears = Number(years[0]) + 1;
                var maxyears = Number(years[1]) + 1;
                
                if (maxyears >= 32){
                    go();
                };
                
                filterFunc([minyears, maxyears]);
                
                slider.noUiSlider.set([minyears, maxyears]);
            };
            
            function filterFunc(yer){
                var bottomYear = Number(yearLi[yer[0]]);
                bottomYear = ['<=', 'YEAR', bottomYear];
                var topYear = Number(yearLi[yer[1]]);
                topYear = ['>=', 'YEAR', topYear];
                
                filter = [bottomYear, topYear];
                
                map.setFilter('plantYears', ['all', filter]);

            };
                        
            function yearTextContent(heldValues) {
                document.getElementById('maxYear').textContent = Number(heldValues[1]);
                document.getElementById('minYear').textContent = Number(heldValues[0]);
            }
            
            function plantTypeFilter() {
                
            };
            
            function filterbytype(index) {
                if (index == 1) {
                    document.getElementById('all').checked = false;
                    document.getElementById('aq').checked = false;
                    document.getElementById('new').checked = false;
                } else if (index == 2) {
                    document.getElementById('all').checked = false;
                    document.getElementById('jv').checked = false;
                    document.getElementById('new').checked = false;
                } else if (index == 3) {                    
                    document.getElementById('all').checked = false;
                    document.getElementById('aq').checked = false;
                    document.getElementById('jv').checked = false;
                } else if (index == 0) {
                    document.getElementById('jv').checked = false;
                    document.getElementById('aq').checked = false;
                    document.getElementById('new').checked = false;
                }
            }
            
            
           
            
        </script>
    </body>
</html>